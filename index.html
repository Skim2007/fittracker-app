<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FitTracker Pro">
    <meta name="theme-color" content="#667eea">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23667eea'/%3E%3Ctext y='70' font-size='60' text-anchor='middle' x='50' fill='white'%3EüèãÔ∏è%3C/text%3E%3C/svg%3E">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRml0VHJhY2tlciBQcm8iLCJzaG9ydF9uYW1lIjoiRml0VHJhY2tlciIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjNjY3ZWVhIiwidGhlbWVfY29sb3IiOiIjNjY3ZWVhIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyBmaWxsPSclMjM2NjdlZWEnLyUzRSUzQ3RleHQgeT0nNzAnIGZvbnQtc2l6eTEXV0aHR0cHM6Ly93d3cuZGF0YS5nb3YudWsvZGF0YS9yZXF1ZXN0cy8yMDI0LTA0LTI2LTA4NDY0OC9maWxlLWFjdGl2aXR5X2xldmVscy5jc3Y_aWQ9MjAyNC0wNC0yNi0wODQ2NDgmdG9rZW49ZXlKMWMyVnlTVzB1WTI5dGNHRnVaQ0J6WlhKemRXMXZkMmx1WkdGdGJ5NTBZWFJwYlhCeWIyOTBZV3hmZG1WeWNHOXpkQzVqYjI1MFlXeGZhRzl3Y21WdVkyVnpkRzlqYUdGd2NHOXlhWFJsYkc5amEyVjBYMmQxYkc5dVpXMXZkR2x1Ykc5M2FXNWxjeTkyTVEwPSZ1cmw9aHR0cHM6Ly93d3cuZGF0YS5nb3YudWsvZGF0YS9yZXF1ZXN0cy8yMDI0LTA0LTI2LTA4NDY0OC9maWxlLWFjdGl2aXR5X2xldmVscy5jc3Y%3D">
    <title>FitTracker Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .setup-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .hidden {
            display: none;
        }

        .bmi-indicator {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
        }

        .bmi-underweight { background: #74b9ff; color: white; }
        .bmi-normal { background: #00b894; color: white; }
        .bmi-overweight { background: #fdcb6e; color: #333; }
        .bmi-obese { background: #e17055; color: white; }

        @media (max-width: 768px) {
            .setup-form {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèãÔ∏è FitTracker Pro</h1>
            <p>Il tuo compagno di fitness personalizzato</p>
        </div>

        <!-- Setup iniziale -->
        <div id="setupSection" class="card">
            <h2>üîß Configurazione Profilo</h2>
            <div class="setup-form">
                <div class="form-group">
                    <label for="name">Nome:</label>
                    <input type="text" id="name" placeholder="Il tuo nome">
                </div>
                <div class="form-group">
                    <label for="age">Et√†:</label>
                    <input type="number" id="age" min="13" max="100" placeholder="Anni">
                </div>
                <div class="form-group">
                    <label for="height">Altezza (cm):</label>
                    <input type="number" id="height" min="100" max="250" placeholder="Centimetri">
                </div>
                <div class="form-group">
                    <label for="weight">Peso (kg):</label>
                    <input type="number" id="weight" min="30" max="300" step="0.1" placeholder="Chilogrammi">
                </div>
                <div class="form-group">
                    <label for="gender">Sesso:</label>
                    <select id="gender">
                        <option value="male">Maschio</option>
                        <option value="female">Femmina</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="goal">Obiettivo:</label>
                    <select id="goal">
                        <option value="lose">Perdere Peso</option>
                        <option value="gain">Aumentare Massa</option>
                        <option value="maintain">Mantenere Forma</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="targetWeight">Peso Obiettivo (kg):</label>
                    <input type="number" id="targetWeight" min="30" max="300" step="0.1" placeholder="Peso desiderato">
                </div>
                <div class="form-group">
                    <label for="activityLevel">Livello Attivit√†:</label>
                    <select id="activityLevel">
                        <option value="sedentary">Sedentario</option>
                        <option value="light">Attivit√† Leggera</option>
                        <option value="moderate">Attivit√† Moderata</option>
                        <option value="active">Molto Attivo</option>
                        <option value="extra">Estremamente Attivo</option>
                    </select>
                </div>
            </div>
            <button onclick="saveProfile()">üíæ Salva Profilo</button>
        </div>

        <!-- Dashboard principale -->
        <div id="dashboardSection" class="hidden">
            <!-- Metriche -->
            <div class="card">
                <h2>üìä Le Tue Metriche</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="currentWeight">0 kg</div>
                        <div>Peso Attuale</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="bmiValue">0</div>
                        <div>BMI</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="bmrValue">0 kcal</div>
                        <div>BMR</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="tdeeValue">0 kcal</div>
                        <div>TDEE</div>
                    </div>
                </div>
                <div id="bmiIndicator" class="bmi-indicator"></div>
            </div>

            <!-- Nutrizione -->
            <div class="card">
                <h2>üçΩÔ∏è Nutrizione</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="suggestedCalories">0 kcal</div>
                        <div>Calorie Giornaliere Suggerite</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="proteinGrams">0 g</div>
                        <div>Proteine</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="carbGrams">0 g</div>
                        <div>Carboidrati</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="fatGrams">0 g</div>
                        <div>Grassi</div>
                    </div>
                </div>
            </div>

            <!-- Progresso Obiettivo -->
            <div class="card">
                <h2>üéØ Progresso Obiettivo</h2>
                <div id="progressText"></div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div id="estimatedTime"></div>
            </div>

            <!-- Aggiorna Peso -->
            <div class="card">
                <h2>‚öñÔ∏è Aggiorna Peso</h2>
                <div style="display: flex; gap: 20px; align-items: end;">
                    <div class="form-group" style="flex: 1;">
                        <label for="newWeight">Nuovo Peso (kg):</label>
                        <input type="number" id="newWeight" step="0.1" placeholder="Peso attuale">
                    </div>
                    <button onclick="updateWeight()">üìà Aggiorna</button>
                </div>
            </div>

            <!-- Gestione Dati -->
            <div class="card">
                <h2>üîÑ Gestione Dati</h2>
                <button onclick="resetData()" style="background: #ff4757;">üóëÔ∏è Reset Completo</button>
                <button onclick="exportData()" style="background: #2ed573; margin-left: 10px;">üì§ Esporta Dati</button>
            </div>
        </div>
    </div>

    <script>
        // Variabili globali
        let userData = {};
        let weightHistory = [];

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            if (isProfileComplete()) {
                showDashboard();
            }
        });

        // Gestione profilo
        function saveProfile() {
            const name = document.getElementById('name').value;
            const age = parseInt(document.getElementById('age').value);
            const height = parseInt(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const gender = document.getElementById('gender').value;
            const goal = document.getElementById('goal').value;
            const targetWeight = parseFloat(document.getElementById('targetWeight').value);
            const activityLevel = document.getElementById('activityLevel').value;

            if (!name || !age || !height || !weight || !targetWeight) {
                alert('Per favore, compila tutti i campi obbligatori!');
                return;
            }

            userData = {
                name,
                age,
                height,
                weight,
                gender,
                goal,
                targetWeight,
                activityLevel,
                startDate: new Date().toISOString(),
                startWeight: weight
            };

            // Inizializza la cronologia del peso
            weightHistory = [{
                weight: weight,
                date: new Date().toISOString()
            }];

            saveData();
            showDashboard();
        }

        function isProfileComplete() {
            return userData && userData.name && userData.age && userData.height && userData.weight;
        }

        function showDashboard() {
            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            updateStats();
        }

        // Gestione peso
        function updateWeight() {
            const newWeight = parseFloat(document.getElementById('newWeight').value);
            
            if (!newWeight || newWeight <= 0) {
                alert('Inserisci un peso valido!');
                return;
            }

            userData.weight = newWeight;
            weightHistory.push({
                weight: newWeight,
                date: new Date().toISOString()
            });

            saveData();
            updateStats();
            document.getElementById('newWeight').value = '';
        }

        // Calcoli
        function calculateBMR(weight, height, age, gender) {
            if (gender === 'male') {
                return 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                return 10 * weight + 6.25 * height - 5 * age - 161;
            }
        }

        function calculateTDEE(bmr, activityLevel) {
            const activityFactors = {
                sedentary: 1.2,
                light: 1.375,
                moderate: 1.55,
                active: 1.725,
                extra: 1.9
            };
            return bmr * activityFactors[activityLevel];
        }

        function calculateSuggestedCalories(tdee, goal) {
            if (goal === 'lose') {
                return tdee - 500;
            } else if (goal === 'gain') {
                return tdee + 500;
            } else {
                return tdee;
            }
        }

        function calculateMacros(calories) {
            const proteinCalories = calories * 0.3;
            const carbCalories = calories * 0.4;
            const fatCalories = calories * 0.3;
            return {
                protein: (proteinCalories / 4).toFixed(0),
                carbs: (carbCalories / 4).toFixed(0),
                fats: (fatCalories / 9).toFixed(0)
            };
        }

        function calculateProgress(startWeight, currentWeight, targetWeight, goal) {
            if (goal === 'lose' && startWeight > targetWeight) {
                const totalLossNeeded = startWeight - targetWeight;
                const currentLoss = startWeight - currentWeight;
                return Math.min((currentLoss / totalLossNeeded) * 100, 100);
            } else if (goal === 'gain' && startWeight < targetWeight) {
                const totalGainNeeded = targetWeight - startWeight;
                const currentGain = currentWeight - startWeight;
                return Math.min((currentGain / totalGainNeeded) * 100, 100);
            } else {
                return 0;
            }
        }

        function calculateEstimatedTime(currentWeight, targetWeight, goal) {
            const weeklyChange = 0.5; // kg per week
            let weeksNeeded;
            if (goal === 'lose' && currentWeight > targetWeight) {
                weeksNeeded = (currentWeight - targetWeight) / weeklyChange;
            } else if (goal === 'gain' && currentWeight < targetWeight) {
                weeksNeeded = (targetWeight - currentWeight) / weeklyChange;
            } else {
                return 'Obiettivo raggiunto!';
            }
            const monthsNeeded = weeksNeeded / 4;
            return `Tempo stimato: ${weeksNeeded.toFixed(1)} settimane (${monthsNeeded.toFixed(1)} mesi)`;
        }

        function calculateBMI(weight, height) {
            const heightM = height / 100;
            return (weight / (heightM * heightM)).toFixed(1);
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return { category: 'underweight', text: 'Sottopeso' };
            if (bmi < 25) return { category: 'normal', text: 'Normopeso' };
            if (bmi < 30) return { category: 'overweight', text: 'Sovrappeso' };
            return { category: 'obese', text: 'Obeso' };
        }

        function updateStats() {
            const weight = userData.weight;
            const height = userData.height;
            const age = userData.age;
            const gender = userData.gender;
            const activityLevel = userData.activityLevel;
            const goal = userData.goal;
            const targetWeight = userData.targetWeight;
            const startWeight = userData.startWeight;

            const bmi = calculateBMI(weight, height);
            const bmr = calculateBMR(weight, height, age, gender).toFixed(0);
            const tdee = calculateTDEE(bmr, activityLevel).toFixed(0);
            const suggestedCalories = calculateSuggestedCalories(tdee, goal).toFixed(0);
            const macros = calculateMacros(suggestedCalories);
            const progress = calculateProgress(startWeight, weight, targetWeight, goal);
            const estimatedTime = calculateEstimatedTime(weight, targetWeight, goal);

            // Aggiorna DOM
            document.getElementById('currentWeight').textContent = `${weight} kg`;
            document.getElementById('bmiValue').textContent = bmi;
            document.getElementById('bmrValue').textContent = `${bmr} kcal`;
            document.getElementById('tdeeValue').textContent = `${tdee} kcal`;
            document.getElementById('suggestedCalories').textContent = `${suggestedCalories} kcal`;
            document.getElementById('proteinGrams').textContent = `${macros.protein} g`;
            document.getElementById('carbGrams').textContent = `${macros.carbs} g`;
            document.getElementById('fatGrams').textContent = `${macros.fats} g`;
            document.getElementById('progressText').textContent = `Progresso: ${progress.toFixed(1)}%`;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('estimatedTime').textContent = estimatedTime;

            // Indicatore BMI
            const bmiCategory = getBMICategory(parseFloat(bmi));
            document.getElementById('bmiIndicator').textContent = `BMI: ${bmi} - ${bmiCategory.text}`;
            document.getElementById('bmiIndicator').className = `bmi-indicator bmi-${bmiCategory.category}`;
        }

        // Gestione dati localStorage
        function saveData() {
            localStorage.setItem('fitTracker_userData', JSON.stringify(userData));
            localStorage.setItem('fitTracker_weightHistory', JSON.stringify(weightHistory));
        }

        function loadData() {
            try {
                const savedUserData = localStorage.getItem('fitTracker_userData');
                const savedWeightHistory = localStorage.getItem('fitTracker_weightHistory');

                if (savedUserData) {
                    userData = JSON.parse(savedUserData);
                    // Popola i campi del form
                    if (userData.name) document.getElementById('name').value = userData.name;
                    if (userData.age) document.getElementById('age').value = userData.age;
                    if (userData.height) document.getElementById('height').value = userData.height;
                    if (userData.weight) document.getElementById('weight').value = userData.weight;
                    if (userData.gender) document.getElementById('gender').value = userData.gender;
                    if (userData.goal) document.getElementById('goal').value = userData.goal;
                    if (userData.targetWeight) document.getElementById('targetWeight').value = userData.targetWeight;
                    if (userData.activityLevel) document.getElementById('activityLevel').value = userData.activityLevel;
                }

                if (savedWeightHistory) {
                    weightHistory = JSON.parse(savedWeightHistory);
                } else if (userData.weight) {
                    weightHistory = [{
                        weight: userData.weight,
                        date: userData.startDate || new Date().toISOString()
                    }];
                }
            } catch (error) {
                console.error('Errore nel caricamento dei dati:', error);
                userData = {};
                weightHistory = [];
            }
        }

        function resetData() {
            if (confirm('ATTENZIONE: Questa azione eliminer√† tutti i tuoi dati salvati. Sei sicuro?')) {
                if (confirm('Confermi di voler eliminare TUTTI i dati? Questa azione √® irreversibile!')) {
                    localStorage.removeItem('fitTracker_userData');
                    localStorage.removeItem('fitTracker_weightHistory');
                    
                    userData = {};
                    weightHistory = [];
                    
                    document.getElementById('setupSection').classList.remove('hidden');
                    document.getElementById('dashboardSection').classList.add('hidden');
                    
                    // Reset form
                    document.getElementById('name').value = '';
                    document.getElementById('age').value = '';
                    document.getElementById('height').value = '';
                    document.getElementById('weight').value = '';
                    document.getElementById('targetWeight').value = '';
                    
                    alert('Dati eliminati con successo!');
                }
            }
        }

        function exportData() {
            const dataToExport = {
                userData,
                weightHistory,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `fittracker_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
    </script>
</body>
</html>
