<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí™ FitTracker Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #4c51bf;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #4a5568;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-logout {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            width: auto;
            padding: 10px 20px;
            font-size: 0.9rem;
            margin: 0;
            float: right;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .macros-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .macro-card {
            background: linear-gradient(135deg, #fa709a, #fee140);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            color: white;
            font-weight: 600;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .bmi-indicator {
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            margin-top: 15px;
        }

        .bmi-underweight { background: #3182ce; color: white; }
        .bmi-normal { background: #38a169; color: white; }
        .bmi-overweight { background: #d69e2e; color: white; }
        .bmi-obese { background: #e53e3e; color: white; }

        .prediction-card {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            color: #2d3748;
        }

        .hidden { display: none; }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab {
            padding: 12px 20px;
            background: rgba(255,255,255,0.7);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #4a5568;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
        }

        /* Login/Registration styles */
        .auth-card {
            max-width: 400px;
            margin: 50px auto;
        }

        .auth-toggle {
            text-align: center;
            margin-top: 20px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .history-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            border-radius: 15px;
            color: white;
        }

        .history-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: white;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .macros-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }

            .user-info {
                flex-direction: column;
                gap: 10px;
            }

            .btn-logout {
                float: none;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Schermata di autenticazione -->
        <div id="auth-screen">
            <div class="header">
                <h1>üí™ FitTracker Pro</h1>
                <p>Il tuo compagno fitness intelligente</p>
            </div>

            <div id="login-card" class="card auth-card">
                <h2>üîê Accesso</h2>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" placeholder="Inserisci la tua password">
                </div>
                <button class="btn" onclick="login()">üöÄ Accedi</button>
                <div class="auth-toggle" onclick="showRegister()">Prima volta? Crea una password</div>
            </div>

            <div id="register-card" class="card auth-card hidden">
                <h2>üìù Prima configurazione</h2>
                <div class="form-group">
                    <label for="new-password">Crea una password:</label>
                    <input type="password" id="new-password" placeholder="Scegli una password sicura">
                </div>
                <div class="form-group">
                    <label for="confirm-password">Conferma password:</label>
                    <input type="password" id="confirm-password" placeholder="Ripeti la password">
                </div>
                <button class="btn" onclick="register()">üîí Crea account</button>
                <div class="auth-toggle" onclick="showLogin()">Hai gi√† una password? Accedi</div>
            </div>
        </div>

        <!-- Applicazione principale -->
        <div id="main-app" class="hidden">
            <div class="header">
                <h1>üí™ FitTracker Pro</h1>
                <p>Il tuo compagno fitness intelligente</p>
            </div>

            <div class="user-info">
                <div>Benvenuto nel tuo FitTracker personale!</div>
                <button class="btn btn-logout" onclick="logout()">üö™ Esci</button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('setup')">üìù Setup</button>
                <button class="tab" onclick="showTab('stats')">üìä Statistiche</button>
                <button class="tab" onclick="showTab('nutrition')">üçé Nutrizione</button>
                <button class="tab" onclick="showTab('progress')">üéØ Progresso</button>
                <button class="tab" onclick="showTab('history')">üìà Storico</button>
            </div>

            <!-- Setup -->
            <div id="setup-tab" class="card">
                <h2>üìù Configurazione Profilo</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="age">Et√† (anni):</label>
                        <input type="number" id="age" min="13" max="100" placeholder="25" value="25">
                    </div>
                    <div class="form-group">
                        <label for="gender">Sesso:</label>
                        <select id="gender">
                            <option value="male">Maschio</option>
                            <option value="female">Femmina</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="height">Altezza (cm):</label>
                        <input type="number" id="height" min="100" max="250" placeholder="170" value="170">
                    </div>
                    <div class="form-group">
                        <label for="weight">Peso attuale (kg):</label>
                        <input type="number" id="weight" min="30" max="300" step="0.1" placeholder="70" value="70">
                    </div>
                    <div class="form-group">
                        <label for="activity">Livello attivit√†:</label>
                        <select id="activity">
                            <option value="1.2">Sedentario</option>
                            <option value="1.375">Leggermente attivo</option>
                            <option value="1.55" selected>Moderatamente attivo</option>
                            <option value="1.725">Molto attivo</option>
                            <option value="1.9">Estremamente attivo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="goal">Obiettivo:</label>
                        <select id="goal">
                            <option value="lose">Perdere peso</option>
                            <option value="maintain" selected>Mantenere peso</option>
                            <option value="gain">Aumentare peso</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="calculateAll()">üöÄ Calcola le tue metriche</button>
            </div>

            <!-- Statistiche -->
            <div id="stats-tab" class="card hidden">
                <h2>üìä Le Tue Metriche</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="bmi-value">0</div>
                        <div class="stat-label">BMI</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="bmr-value">0</div>
                        <div class="stat-label">BMR (kcal)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="tdee-value">0</div>
                        <div class="stat-label">TDEE (kcal)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="target-value">0</div>
                        <div class="stat-label">Calorie obiettivo</div>
                    </div>
                </div>
                <div id="bmi-indicator" class="bmi-indicator"></div>
            </div>

            <!-- Nutrizione -->
            <div id="nutrition-tab" class="card hidden">
                <h2>üçé Piano Nutrizionale</h2>
                <div class="macros-grid">
                    <div class="macro-card">
                        <div style="font-size: 1.5rem; font-weight: 700;" id="protein-value">0g</div>
                        <div>Proteine</div>
                    </div>
                    <div class="macro-card">
                        <div style="font-size: 1.5rem; font-weight: 700;" id="carbs-value">0g</div>
                        <div>Carboidrati</div>
                    </div>
                    <div class="macro-card">
                        <div style="font-size: 1.5rem; font-weight: 700;" id="fats-value">0g</div>
                        <div>Grassi</div>
                    </div>
                </div>
            </div>

            <!-- Progresso -->
            <div id="progress-tab" class="card hidden">
                <h2>üéØ Simulazione Progresso</h2>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="target-weight">Peso obiettivo (kg):</label>
                    <input type="number" id="target-weight" min="30" max="300" step="0.1" placeholder="65" value="65">
                </div>
                <button class="btn" onclick="calculateProgress()" style="margin-bottom: 20px;">üìà Calcola tempo stimato</button>
                
                <div id="progress-result" class="prediction-card hidden">
                    <h3 style="margin-bottom: 15px;">üéØ Previsioni</h3>
                    <div id="progress-text"></div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div id="time-estimate"></div>
                    <div id="recommendations" style="margin-top: 15px;"></div>
                </div>
            </div>

            <!-- Storico -->
            <div id="history-tab" class="card hidden">
                <h2>üìà Storico delle Misurazioni</h2>
                <div id="history-content">
                    <p>Nessuna misurazione salvata ancora. Calcola le tue metriche per iniziare!</p>
                </div>
                <button class="btn" onclick="clearHistory()" style="background: linear-gradient(135deg, #e53e3e, #c53030); margin-top: 20px;">üóëÔ∏è Cancella storico</button>
            </div>
        </div>
    </div>

    <script>
        let currentData = {};
        let userHistory = [];

        // Gestione autenticazione
        function showLogin() {
            document.getElementById('login-card').classList.remove('hidden');
            document.getElementById('register-card').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-card').classList.add('hidden');
            document.getElementById('register-card').classList.remove('hidden');
        }

        function register() {
            const password = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (!password || password.length < 4) {
                alert('La password deve essere di almeno 4 caratteri!');
                return;
            }

            if (password !== confirmPassword) {
                alert('Le password non coincidono!');
                return;
            }

            // Salva la password (in un'app reale useresti hash)
            localStorage.setItem('fittracker_password', password);
            localStorage.setItem('fittracker_setup_complete', 'true');
            
            showMainApp();
        }

        function login() {
            const password = document.getElementById('login-password').value;
            const savedPassword = localStorage.getItem('fittracker_password');

            if (!savedPassword) {
                alert('Nessun account trovato. Crea prima una password!');
                showRegister();
                return;
            }

            if (password !== savedPassword) {
                alert('Password errata!');
                return;
            }

            showMainApp();
        }

        function logout() {
            if (confirm('Sei sicuro di voler uscire?')) {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                document.getElementById('login-password').value = '';
                showLogin();
            }
        }

        function showMainApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            loadUserData();
            loadHistory();
        }

        // Gestione dati utente
        function saveUserData() {
            const userData = {
                age: document.getElementById('age').value,
                gender: document.getElementById('gender').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                activity: document.getElementById('activity').value,
                goal: document.getElementById('goal').value
            };
            localStorage.setItem('fittracker_userdata', JSON.stringify(userData));
        }

        function loadUserData() {
            const savedData = localStorage.getItem('fittracker_userdata');
            if (savedData) {
                const userData = JSON.parse(savedData);
                document.getElementById('age').value = userData.age || 25;
                document.getElementById('gender').value = userData.gender || 'male';
                document.getElementById('height').value = userData.height || 170;
                document.getElementById('weight').value = userData.weight || 70;
                document.getElementById('activity').value = userData.activity || 1.55;
                document.getElementById('goal').value = userData.goal || 'maintain';
            }
        }

        function saveToHistory() {
            const entry = {
                date: new Date().toLocaleDateString('it-IT'),
                time: new Date().toLocaleTimeString('it-IT'),
                weight: currentData.weight,
                bmi: currentData.bmi,
                bmr: currentData.bmr,
                tdee: currentData.tdee,
                targetCalories: currentData.targetCalories,
                goal: currentData.goal
            };

            userHistory = JSON.parse(localStorage.getItem('fittracker_history') || '[]');
            userHistory.unshift(entry); // Aggiungi all'inizio
            
            // Mantieni solo gli ultimi 50 record
            if (userHistory.length > 50) {
                userHistory = userHistory.slice(0, 50);
            }
            
            localStorage.setItem('fittracker_history', JSON.stringify(userHistory));
        }

        function loadHistory() {
            userHistory = JSON.parse(localStorage.getItem('fittracker_history') || '[]');
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyContent = document.getElementById('history-content');
            
            if (userHistory.length === 0) {
                historyContent.innerHTML = '<p>Nessuna misurazione salvata ancora. Calcola le tue metriche per iniziare!</p>';
                return;
            }

            let historyHTML = '<div class="history-section"><h3>üìä Le tue misurazioni</h3>';
            
            userHistory.forEach((entry, index) => {
                historyHTML += `
                    <div class="history-item">
                        <div style="font-weight: bold; margin-bottom: 5px;">
                            ${entry.date} - ${entry.time}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; font-size: 0.9rem;">
                            <div>Peso: ${entry.weight}kg</div>
                            <div>BMI: ${entry.bmi}</div>
                            <div>BMR: ${entry.bmr} kcal</div>
                            <div>TDEE: ${entry.tdee} kcal</div>
                            <div>Obiettivo: ${entry.targetCalories} kcal</div>
                            <div>Goal: ${entry.goal === 'lose' ? 'Perdere' : entry.goal === 'gain' ? 'Aumentare' : 'Mantenere'}</div>
                        </div>
                    </div>
                `;
            });
            
            historyHTML += '</div>';
            historyContent.innerHTML = historyHTML;
        }

        function clearHistory() {
            if (confirm('Sei sicuro di voler cancellare tutto lo storico? Questa azione non pu√≤ essere annullata.')) {
                localStorage.removeItem('fittracker_history');
                userHistory = [];
                updateHistoryDisplay();
                alert('Storico cancellato con successo!');
            }
        }

        // Funzioni di calcolo (rimangono uguali)
        function showTab(tabName) {
            document.querySelectorAll('.card').forEach(card => card.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            event.target.classList.add('active');
        }

        function calculateBMI(weight, height) {
            const heightM = height / 100;
            return (weight / (heightM * heightM)).toFixed(1);
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return { category: 'underweight', text: 'Sottopeso', advice: 'Considera di aumentare leggermente il peso' };
            if (bmi < 25) return { category: 'normal', text: 'Normopeso', advice: 'Mantieni questo peso ideale!' };
            if (bmi < 30) return { category: 'overweight', text: 'Sovrappeso', advice: 'Un leggero calo di peso sarebbe benefico' };
            return { category: 'obese', text: 'Obesit√†', advice: 'Consigliato un piano per la perdita di peso' };
        }

        function calculateBMR(weight, height, age, gender) {
            if (gender === 'male') {
                return Math.round(88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age));
            } else {
                return Math.round(447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age));
            }
        }

        function calculateMacros(calories, goal) {
            let proteinRatio, carbRatio, fatRatio;
            
            switch(goal) {
                case 'lose':
                    proteinRatio = 0.35; carbRatio = 0.30; fatRatio = 0.35;
                    break;
                case 'gain':
                    proteinRatio = 0.25; carbRatio = 0.50; fatRatio = 0.25;
                    break;
                default:
                    proteinRatio = 0.30; carbRatio = 0.40; fatRatio = 0.30;
            }
            
            return {
                protein: Math.round((calories * proteinRatio) / 4),
                carbs: Math.round((calories * carbRatio) / 4),
                fats: Math.round((calories * fatRatio) / 9)
            };
        }

        function calculateAll() {
            const age = parseInt(document.getElementById('age').value) || 25;
            const gender = document.getElementById('gender').value;
            const height = parseFloat(document.getElementById('height').value) || 170;
            const weight = parseFloat(document.getElementById('weight').value) || 70;
            const activity = parseFloat(document.getElementById('activity').value) || 1.55;
            const goal = document.getElementById('goal').value;

            const bmi = calculateBMI(weight, height);
            const bmiInfo = getBMICategory(parseFloat(bmi));
            const bmr = calculateBMR(weight, height, age, gender);
            const tdee = Math.round(bmr * activity);
            
            let targetCalories = tdee;
            if (goal === 'lose') targetCalories -= 500;
            else if (goal === 'gain') targetCalories += 300;

            const macros = calculateMacros(targetCalories, goal);

            currentData = { age, gender, height, weight, activity, goal, bmi, bmr, tdee, targetCalories, macros, bmiInfo };

            // Salva i dati
            saveUserData();
            saveToHistory();
            loadHistory();

            updateStats();
            updateNutrition();

            showTab('stats');
            document.querySelector('.tab[onclick="showTab(\'stats\')"]').click();
        }

        function updateStats() {
            if (!currentData.bmi) return;

            document.getElementById('bmi-value').textContent = currentData.bmi;
            document.getElementById('bmr-value').textContent = currentData.bmr;
            document.getElementById('tdee-value').textContent = currentData.tdee;
            document.getElementById('target-value').textContent = currentData.targetCalories;

            const indicator = document.getElementById('bmi-indicator');
            indicator.textContent = `BMI: ${currentData.bmi} - ${currentData.bmiInfo.text}. ${currentData.bmiInfo.advice}`;
            indicator.className = `bmi-indicator bmi-${currentData.bmiInfo.category}`;
        }

        function updateNutrition() {
            if (!currentData.macros) return;

            document.getElementById('protein-value').textContent = currentData.macros.protein + 'g';
            document.getElementById('carbs-value').textContent = currentData.macros.carbs + 'g';
            document.getElementById('fats-value').textContent = currentData.macros.fats + 'g';
        }

        function calculateProgress() {
            if (!currentData.weight) {
                alert('Prima calcola le tue metriche nella sezione Setup!');
                return;
            }

            const targetWeight = parseFloat(document.getElementById('target-weight').value);
            if (!targetWeight) {
                alert('Inserisci un peso obiettivo valido!');
                return;
            }

            const currentWeight = currentData.weight;
            const weightDiff = Math.abs(currentWeight - targetWeight);
            const isLosing = currentWeight > targetWeight;
            
            const weeklyRate = isLosing ? 0.5 : 0.3;
            const weeksNeeded = Math.ceil(weightDiff / weeklyRate);
            const monthsNeeded = Math.ceil(weeksNeeded / 4);

            const progressPercent = Math.min(100, (weightDiff * 10));

            document.getElementById('progress-result').classList.remove('hidden');
            document.getElementById('progress-text').innerHTML = `
                <strong>Peso attuale:</strong> ${currentWeight}kg ‚Üí <strong>Obiettivo:</strong> ${targetWeight}kg<br>
                <strong>Differenza:</strong> ${weightDiff.toFixed(1)}kg da ${isLosing ? 'perdere' : 'guadagnare'}
            `;
            
            document.getElementById('progress-fill').style.width = Math.min(progressPercent, 100) + '%';
            
            document.getElementById('time-estimate').innerHTML = `
                <h4>‚è±Ô∏è Tempo stim
