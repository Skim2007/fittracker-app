<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FitTracker Pro">
    <meta name="theme-color" content="#4f46e5">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%234f46e5'/%3E%3Ctext y='70' font-size='50' text-anchor='middle' x='50' fill='white'%3E‚ö°%3C/text%3E%3C/svg%3E">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRml0VHJhY2tlciBQcm8iLCJzaG9ydF9uYW1lIjoiRml0VHJhY2tlciIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjNGY0NmU1IiwidGhlbWVfY29sb3IiOiIjNGY0NmU1IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMTAwIDEwMCclM0UlM0NyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyByeD0nMjAnIGZpbGw9JyUyMzRmNDZlNScvJTNFJTNJdGV4dCB5PSc3MCcgZm9udC1zaXplPSc1MCcgdGV4dC1hbmNob3I9J21pZGRsZScgeÂΩºÊ≠§0e='50'IGZpbGw9J3doaXRlJyUzRSVFMiU4MiVBMSUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <title>FitTracker Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2.5rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .setup-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        input, select {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #f472b6 0%, #f9a8d4 100%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 1rem;
            background: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            transition: width 0.5s ease;
        }

        .bmi-indicator {
            padding: 0.75rem;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: 600;
            margin-top: 1rem;
        }

        .bmi-underweight { background: #60a5fa; color: white; }
        .bmi-normal { background: #10b981; color: white; }
        .bmi-overweight { background: #facc15; color: #1f2937; }
        .bmi-obese { background: #ef4444; color: white; }

        .macros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .macro-card {
            background: linear-gradient(135deg, #34d399 0%, #6ee7b7 100%);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            color: white;
        }

        .macro-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .goal-prediction {
            background: linear-gradient(135deg, #a5f3fc 0%, #e879f9 100%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .setup-form {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° FitTracker Pro</h1>
            <p>Il tuo calcolatore fitness avanzato</p>
        </div>

        <!-- Setup iniziale -->
        <div id="setupSection" class="card">
            <h2>üîß Configura il tuo Profilo</h2>
            <div class="setup-form">
                <div class="form-group">
                    <label for="name">Nome:</label>
                    <input type="text" id="name" placeholder="Il tuo nome">
                </div>
                <div class="form-group">
                    <label for="age">Et√†:</label>
                    <input type="number" id="age" min="13" max="100" placeholder="Anni">
                </div>
                <div class="form-group">
                    <label for="height">Altezza (cm):</label>
                    <input type="number" id="height" min="100" max="250" placeholder="Centimetri">
                </div>
                <div class="form-group">
                    <label for="weight">Peso (kg):</label>
                    <input type="number" id="weight" min="30" max="300" step="0.1" placeholder="Chilogrammi">
                </div>
                <div class="form-group">
                    <label for="waist">Circonferenza vita (cm):</label>
                    <input type="number" id="waist" min="40" max="200" step="0.1" placeholder="Centimetri">
                </div>
                <div class="form-group">
                    <label for="gender">Sesso:</label>
                    <select id="gender">
                        <option value="male">Maschio</option>
                        <option value="female">Femmina</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="goal">Obiettivo:</label>
                    <select id="goal">
                        <option value="lose">Perdere Peso</option>
                        <option value="gain">Aumentare Massa</option>
                        <option value="maintain">Mantenere Forma</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="targetWeight">Peso Obiettivo (kg):</label>
                    <input type="number" id="targetWeight" min="30" max="300" step="0.1" placeholder="Peso desiderato">
                </div>
                <div class="form-group">
                    <label for="activityLevel">Livello Attivit√†:</label>
                    <select id="activityLevel">
                        <option value="sedentary">Sedentario (1-2 allenamenti/settimana)</option>
                        <option value="light">Leggero (3-4 allenamenti/settimana)</option>
                        <option value="moderate">Moderato (5-6 allenamenti/settimana)</option>
                        <option value="active">Attivo (6-7 allenamenti intensi)</option>
                        <option value="extra">Estremamente Attivo (atleta professionista)</option>
                    </select>
                </div>
            </div>
            <button onclick="saveProfile()">üíæ Salva Profilo</button>
        </div>

        <!-- Dashboard principale -->
        <div id="dashboardSection" class="hidden">
            <div class="card">
                <h2>üìä Le Tue Statistiche</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="currentWeight">0</div>
                        <div>Peso Attuale</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="bmiValue">0</div>
                        <div>BMI</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="bodyFat">0%</div>
                        <div>Massa Grassa</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="tdeeValue">0</div>
                        <div>TDEE (kcal)</div>
                    </div>
                </div>
                <div id="bmiIndicator" class="bmi-indicator"></div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                <div id="progressText" style="text-align: center; margin-top: 0.5rem; font-size: 0.9rem; color: #4b5563;"></div>
            </div>

            <div class="card">
                <h2>üçΩÔ∏è Macros Consigliati</h2>
                <div class="macros-grid">
                    <div class="macro-card">
                        <div class="macro-value" id="proteinGrams">0g</div>
                        <div>Proteine</div>
                    </div>
                    <div class="macro-card">
                        <div class="macro-value" id="carbGrams">0g</div>
                        <div>Carboidrati</div>
                    </div>
                    <div class="macro-card">
                        <div class="macro-value" id="fatGrams">0g</div>
                        <div>Grassi</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Progresso Obiettivo</h2>
                <div id="goalPrediction" class="goal-prediction"></div>
            </div>

            <div class="card">
                <h2>‚öñÔ∏è Aggiorna Peso</h2>
                <div style="display: flex; gap: 1.5rem; align-items: end;">
                    <div class="form-group" style="flex: 1;">
                        <label for="newWeight">Nuovo Peso (kg):</label>
                        <input type="number" id="newWeight" step="0.1" placeholder="Peso attuale">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="newWaist">Nuova Circonferenza Vita (cm):</label>
                        <input type="number" id="newWaist" step="0.1" placeholder="Circonferenza vita">
                    </div>
                    <button onclick="updateWeight()">üìà Aggiorna</button>
                </div>
            </div>

            <div class="card">
                <h2>üîÑ Gestione Dati</h2>
                <button onclick="resetData()" style="background: #ef4444;">üóëÔ∏è Reset Dati</button>
                <button onclick="exportData()" style="background: #10b981; margin-left: 1rem;">üì§ Esporta Dati</button>
            </div>
        </div>
    </div>

    <script>
        // Variabili globali
        let userData = {};
        let weightHistory = [];

        // Caricamento dati
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            if (isProfileComplete()) {
                showDashboard();
            }
        });

        function saveProfile() {
            const name = document.getElementById('name').value;
            const age = parseInt(document.getElementById('age').value);
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const waist = parseFloat(document.getElementById('waist').value) || null;
            const gender = document.getElementById('gender').value;
            const goal = document.getElementById('goal').value;
            const targetWeight = parseFloat(document.getElementById('targetWeight').value);
            const activityLevel = document.getElementById('activityLevel').value;

            if (!name || !age || !height || !weight || !targetWeight) {
                alert('Compila tutti i campi obbligatori!');
                return;
            }

            userData = {
                name,
                age,
                height,
                weight,
                waist,
                gender,
                goal,
                targetWeight,
                activityLevel,
                startDate: new Date().toISOString(),
                startWeight: weight
            };

            weightHistory = [{ weight, waist, date: new Date().toISOString() }];
            saveData();
            showDashboard();
        }

        function isProfileComplete() {
            return userData && userData.name && userData.age && userData.height && userData.weight;
        }

        function showDashboard() {
            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            updateStats();
        }

        function updateWeight() {
            const newWeight = parseFloat(document.getElementById('newWeight').value);
            const newWaist = parseFloat(document.getElementById('newWaist').value) || null;

            if (!newWeight || newWeight <= 0) {
                alert('Inserisci un peso valido!');
                return;
            }

            userData.weight = newWeight;
            userData.waist = newWaist;
            weightHistory.push({
                weight: newWeight,
                waist: newWaist,
                date: new Date().toISOString()
            });

            saveData();
            updateStats();
            document.getElementById('newWeight').value = '';
            document.getElementById('newWaist').value = '';
        }

        // Calcoli avanzati
        function calculateBMI() {
            const heightM = userData.height / 100;
            return (userData.weight / (heightM * heightM)).toFixed(1);
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return { category: 'underweight', text: 'Sottopeso' };
            if (bmi < 25) return { category: 'normal', text: 'Normopeso' };
            if (bmi < 30) return { category: 'overweight', text: 'Sovrappeso' };
            return { category: 'obese', text: 'Obeso' };
        }

        function calculateBodyFat() {
            if (!userData.waist) return null;
            const heightInches = userData.height / 2.54;
            const waistInches = userData.waist / 2.54;
            let bodyFat;

            if (userData.gender === 'male') {
                bodyFat = 86.010 * Math.log10(waistInches - 18) - 70.041 * Math.log10(heightInches) + 36.76;
            } else {
                bodyFat = 163.205 * Math.log10(waistInches + 34 - 20) - 97.684 * Math.log10(heightInches) - 78.387;
            }
            return Math.max(5, Math.min(50, bodyFat.toFixed(1)));
        }

        function calculateBMR() {
            // Mifflin-St Jeor Equation
            const weight = userData.weight;
            const height = userData.height;
            const age = userData.age;
            if (userData.gender === 'male') {
                return 10 * weight + 6.25 * height - 5 * age + 5;
            } else {
                return 10 * weight + 6.25 * height - 5 * age - 161;
            }
        }

        function calculateTDEE(bmr) {
            const activityFactors = {
                sedentary: 1.2,
                light: 1.375,
                moderate: 1.55,
                active: 1.725,
                extra: 1.9
            };
            return Math.round(bmr * activityFactors[userData.activityLevel]);
        }

        function calculateMacros(tdee) {
            let proteinRatio, carbRatio, fatRatio;
            if (userData.goal === 'lose') {
                proteinRatio = 0.35;
                carbRatio = 0.35;
                fatRatio = 0.30;
            } else if (userData.goal === 'gain') {
                proteinRatio = 0.30;
                carbRatio = 0.50;
                fatRatio = 0.20;
            } else {
                proteinRatio = 0.30;
                carbRatio = 0.40;
                fatRatio = 0.30;
            }

            return {
                protein: Math.round((tdee * proteinRatio) / 4),
                carbs: Math.round((tdee * carbRatio) / 4),
                fats: Math.round((tdee * fatRatio) / 9)
            };
        }

        function calculateGoalPrediction() {
            const weightDiff = Math.abs(userData.targetWeight - userData.weight);
            const isLosing = userData.weight > userData.targetWeight;
            const weeksNeeded = isLosing
                ? Math.ceil(weightDiff / 0.5)
                : Math.ceil(weightDiff / 0.3);

            return {
                weeks: weeksNeeded,
                months: Math.ceil(weeksNeeded / 4),
                recommendation: getRecommendation()
            };
        }

        function getRecommendation() {
            switch (userData.goal) {
                case 'lose':
                    return 'Mantieni un deficit calorico di 500-750 kcal/giorno con un mix di cardio e allenamenti di forza.';
                case 'gain':
                    return 'Segui un surplus calorico di 300-500 kcal/giorno con focus su allenamenti di forza progressivi.';
                default:
                    return 'Bilancia allenamenti di forza e cardio con un apporto calorico equilibrato.';
            }
        }

        function calculateProgress() {
            const totalChange = Math.abs(userData.startWeight - userData.targetWeight);
            const currentChange = Math.abs(userData.startWeight - userData.weight);
            return Math.min(100, Math.max(0, (currentChange / totalChange) * 100)).toFixed(1);
        }

        function updateStats() {
            const bmi = calculateBMI();
            const bmiCategory = getBMICategory(parseFloat(bmi));
            const bodyFat = calculateBodyFat();
            const bmr = calculateBMR();
            const tdee = calculateTDEE(bmr);
            const macros = calculateMacros(tdee);
            const progress = calculateProgress();
            const prediction = calculateGoalPrediction();

            document.getElementById('currentWeight').textContent = `${userData.weight} kg`;
            document.getElementById('bmiValue').textContent = bmi;
            document.getElementById('bodyFat').textContent = bodyFat ? `${bodyFat}%` : 'N/D';
            document.getElementById('tdeeValue').textContent = tdee;
            document.getElementById('bmiIndicator').textContent = `BMI: ${bmi} - ${bmiCategory.text}`;
            document.getElementById('bmiIndicator').className = `bmi-indicator bmi-${bmiCategory.category}`;
            document.getElementById('proteinGrams').textContent = `${macros.protein}g`;
            document.getElementById('carbGrams').textContent = `${macros.carbs}g`;
            document.getElementById('fatGrams').textContent = `${macros.fats}g`;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Progresso verso l'obiettivo: ${progress}%`;
            document.getElementById('goalPrediction').innerHTML = `
                <h3>üéØ Previsione Obiettivo</h3>
                <p><strong>Tempo stimato:</strong> ${prediction.weeks} settimane (~${prediction.months} mesi)</p>
                <p><strong>Fabbisogno calorico:</strong> ${tdee} kcal/giorno</p>
                <p><strong>Consiglio:</strong> ${prediction.recommendation}</p>
            `;
        }

        function saveData() {
            localStorage.setItem('fitTracker_userData', JSON.stringify(userData));
            localStorage.setItem('fitTracker_weightHistory', JSON.stringify(weightHistory));
        }

        function loadData() {
            try {
                const savedUserData = localStorage.getItem('fitTracker_userData');
                const savedWeightHistory = localStorage.getItem('fitTracker_weightHistory');

                if (savedUserData) {
                    userData = JSON.parse(savedUserData);
                    document.getElementById('name').value = userData.name || '';
                    document.getElementById('age').value = userData.age || '';
                    document.getElementById('height').value = userData.height || '';
                    document.getElementById('weight').value = userData.weight || '';
                    document.getElementById('waist').value = userData.waist || '';
                    document.getElementById('gender').value = userData.gender || 'male';
                    document.getElementById('goal').value = userData.goal || 'maintain';
                    document.getElementById('targetWeight').value = userData.targetWeight || '';
                    document.getElementById('activityLevel').value = userData.activityLevel || 'sedentary';
                }

                if (savedWeightHistory) {
                    weightHistory = JSON.parse(savedWeightHistory);
                }
            } catch (error) {
                console.error('Errore nel caricamento dei dati:', error);
                userData = {};
                weightHistory = [];
            }
        }

        function resetData() {
            if (confirm('ATTENZIONE: Tutti i dati verranno eliminati. Confermi?')) {
                if (confirm('Confermi di voler eliminare TUTTI i dati?')) {
                    localStorage.removeItem('fitTracker_userData');
                    localStorage.removeItem('fitTracker_weightHistory');
                    userData = {};
                    weightHistory = [];
                    document.getElementById('setupSection').classList.remove('hidden');
                    document.getElementById('dashboardSection').classList.add('hidden');
                    document.getElementById('name').value = '';
                    document.getElementById('age').value = '';
                    document.getElementById('height').value = '';
                    document.getElementById('weight').value = '';
                    document.getElementById('waist').value = '';
                    document.getElementById('targetWeight').value = '';
                    alert('Dati eliminati con successo!');
                }
            }
        }

        function exportData() {
            const dataToExport = {
                userData,
                weightHistory,
                exportDate: new Date().toISOString()
            };
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `fittracker_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
    </script>
</body>
</html>
